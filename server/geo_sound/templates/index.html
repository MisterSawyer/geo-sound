<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Geo Sound</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
<link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  </head>
  <body>

<div class="header-bar">
    <button id="burger" class="burger-btn">☰</button>
    <h1 class="app-title">Geo Sound</h1>
      <button id="add-btn" class="add-btn">＋</button>
  </div>

    <div class="container">
      <!-- LEFT COLUMN -->
      <div class="left-panel">
        <h2>All Tracks</h2>
        {% for track in tracks %}
        <div
          class="track"
          id="track-{{ track.metadata.title or track.file }}"
          data-lat="{{ track.metadata.lat }}"
          data-lon="{{ track.metadata.lon }}"
        >
          <div class="track-header">
            <h3 style="color: {{ track.metadata.color or '#000' }}">
              {{ track.metadata.title or track.file }}
            </h3>
            <!-- Delete button -->
            <button
              class="delete-btn"
              onclick="deleteTrack('{{ track.metadata.title or track.file }}')"
              title="Delete track"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  d="M5.5 5.5a.5.5 0 0 1 .5.5v7a.5.5 
             0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zm2.5.5a.5.5 
             0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm3 .5a.5.5 
             0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"
                />
                <path
                  fill-rule="evenodd"
                  d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 
             0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 
             0 0 1 0-2h3a1 1 0 0 1 1-1h4a1 1 0 
             1 1 1 1h3a1 1 0 0 1 1 1z"
                />
              </svg>
            </button>
          </div>

          {% if track.metadata.owner %}
          <p><strong>Owner:</strong> {{ track.metadata.owner }}</p>
          {% endif %} {% if track.metadata.lat and track.metadata.lon %}
          <p>
            <strong>Coordinates:</strong> {{ track.metadata.lat }}, {{
            track.metadata.lon }}
          </p>
          {% endif %}

          <audio controls>
            <source
              src="{{ url_for('sound.serve_sound', filename=track.file) }}"
              type="audio/{{ track.file.split('.')[-1] }}"
            />
          </audio>
        </div>
        {% endfor %}
      </div>

      <!-- RIGHT COLUMN -->
      <div class="right-panel">
        <div id="map"></div>
      </div>


<!-- Hidden slide-down form -->
<div id="add-form-panel" class="add-form-panel">
  <form class="upload" enctype="multipart/form-data">
    <h2>Add New Track</h2>
    <input type="file" name="sound" accept="{{ config.FILE_ACCEPT }}" required />
    <input type="text" name="name" placeholder="Track Name" required />
    <input type="text" name="owner" placeholder="Your Name" />
    <input type="number" step="any" name="lat" placeholder="Latitude" required />
    <input type="number" step="any" name="lon" placeholder="Longitude" required />
    <label for="color">Pin Color:</label>
    <input type="color" name="color" id="color" value="#3388ff" />
    <button type="submit">Upload</button>
  </form>
</div>

    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- Map config -->
    <script>
      window.MAP = L.map('map').setView([20, 0], 2);
      window.BOUNDS = L.latLngBounds([]);
      window.BASE_AUDIO_URL = "{{ url_for('sound.serve_sound', filename='') }}";
      window.BASE_API_UPLOAD_URL = "{{ url_for('api.upload') }}";
      window.BASE_API_DELETE_URL = "{{ url_for('api.delete', name='__NAME__') }}";
      window.TRACKS = {{ tracks|tojson }};
      window.MARKERS = {}
    </script>
    <!-- Local JS -->
    <script src="{{ url_for('static', filename='map.js') }}"></script>
    <script src="{{ url_for('static', filename='tracks.js') }}"></script>
  </body>
</html>
